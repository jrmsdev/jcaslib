stages:
   - build

variables:
    DEBIAN_FRONTEND: noninteractive

before_script:
    - apt-get -qq update && apt-get -qq -y install bmake libgdbm-dev $DEBPKGS
    - $CC --version

.script: &build_script
    - ./configure --use-gdbm
    - bmake depend
    - bmake -j2
    - ./build/lib/libjc.so
    - bmake examples
    - bmake dist
    - bmake check

build_gcc:
    stage: build
    only:
        - master
    image: gcc
    variables:
        CC: gcc
    script: *build_script

debian_stable:
    stage: build
    only:
        - master
    image: debian:stable
    variables:
        CC: gcc
        DEBPKGS: gcc xz-utils
    script: *build_script
